<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.5.0/dist/semantic.min.css" rel="stylesheet">
  <title>ChikaChat - Login/Register</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 30px; background: #f2f2f2; }
    .card { background: #fff; padding: 20px; border-radius: 8px; max-width: 400px; margin: 100px auto; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    input, button { width: 100%; padding: 10px; margin: 10px 0; }
    button { background: #4CAF50; color: white; border: none; cursor: pointer; }
    button:hover { background: #45a049; }
    .switch { text-align: center; margin-top: 10px; }
  </style>
</head>
<body>

  <div class="card" id="login-card">
    <h2>Login</h2>
    <form class="ui form">
      <div class="field">
        <label>Username: </label>
        <input type="text" id="login-username" placeholder="Username" required>
      </div>
      <div class="field">
        <label>Password: </label>
        <input type="password" id="login-password" placeholder="Password" required>
      </div>
      <div class="field">
        <div class="ui checkbox">
          <input type="checkbox" tabindex="0" class="hidden">
          <label>Remember me</label>
        </div>
      </div>
      <span class="ui basic label red" id="login_req"></span>
    </form>
     <button onclick="login()">Login</button>
    <div class="switch">
      <a href="#" onclick="toggleForms()">Donâ€™t have an account? Register</a>
    </div>
  </div>

  <div class="card" id="register-card" style="display:none;">
    <h2>Register</h2>
    <form class="ui form">
      <div class="field">
        <label>Username: </label>
        <input type="text" id="register-username" placeholder="Username" required>
      </div>
      <div class="field">
        <label>Email: </label>
       <input type="email" id="register-email" placeholder="Email" required>
      </div>
      <div class="field">
        <label>Password: </label>
        <input type="password" id="register-password" placeholder="Password" required>
      </div>
      <span class="ui basic label red" id="requirement">Missing field required.</span>
    </form>
    <button onclick="register()">Register</button>
    <div class="switch">
      <a href="#" onclick="toggleForms()">Already have an account? Login</a>
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.5.0/dist/semantic.min.js"></script>
  <script>
    // ðŸ‘‡ Point this to your PHP API
    const API_URL = "http://localhost:8000/index.php?action=";
    document.getElementById('requirement').style.display = 'none';
    document.getElementById('login_req').style.display = 'none';

    function toggleForms() {
      document.getElementById("login-card").style.display =
        document.getElementById("login-card").style.display === "none" ? "block" : "none";
      document.getElementById("register-card").style.display =
        document.getElementById("register-card").style.display === "none" ? "block" : "none";
    }

    async function login() {
      const username = document.getElementById("login-username").value;
      const password = document.getElementById("login-password").value;

      try {
        const res = await fetch(API_URL + "login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password }),
          credentials: "include"
        });
        const data = await res.json();
        if(data.status === "error"){
           document.getElementById('login_req').style.display = 'block';
           document.getElementById('login_req').textContent = data.message;
           return;
        }
        if(data.status === 'success'){
            window.location.href = '/panel.php';
        }
      } catch (err) {
        console.error(err);
      }
    }

    async function register() {
      const username = document.getElementById("register-username").value;
      const email = document.getElementById("register-email").value;
      const password = document.getElementById("register-password").value;

      try {
          const res = await fetch(API_URL + "register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, email, password }),
          credentials: "include"
        });

        const data = await res.json();
        if(data.status === "error"){
           document.getElementById('requirement').style.display = '';
           return;
        }
        document.getElementById('requirement').style.display = 'none';
        if(data.status === 'success'){
          window.location.href = '/panel.php';
        }
        // alert(JSON.stringify(data));
      } catch (err) {
        console.error(err);
        alert("Error connecting to server.");
      }
    }
  </script>
</body>
</html>
